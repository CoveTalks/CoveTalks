<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Dashboard - CoveTalks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: white;
            color: #333;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }
        
        .logo-img {
            height: 70px;
            width: auto;
            display: block;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #155588;
        }

        .nav-links a.active {
            color: #155588;
            border-bottom: 2px solid #155588;
            padding-bottom: 2px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
            font-weight: 500;
            text-align: center;
        }

        .btn-primary {
            background: #155588;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3d6f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: #155588;
            border: 2px solid #155588;
        }

        .btn-secondary:hover {
            background: #155588;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 200px;
            display: none;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1.25rem;
            color: #333;
            text-decoration: none;
            transition: background 0.2s;
        }

        .dropdown-menu a:hover {
            background: #f8f9fa;
        }

        .dropdown-divider {
            height: 1px;
            background: #e1e8ed;
            margin: 0;
        }

        /* Main Content */
        .main-content {
            padding-top: 6rem;
            padding-bottom: 3rem;
            min-height: 100vh;
        }

        /* Dashboard Header */
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #1e93b7 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #155588;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .stat-change {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            background: #d4edda;
            color: #27ae60;
        }

        .stat-change.negative {
            background: #f8d7da;
            color: #dc3545;
        }

        /* Quick Actions */
        .quick-actions {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .quick-actions h2 {
            color: #155588;
            margin-bottom: 1.5rem;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-card {
            padding: 1.5rem;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            color: #333;
        }

        .action-card:hover {
            border-color: #155588;
            background: #f8f9fa;
            transform: translateY(-3px);
        }

        .action-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-title {
            font-weight: 600;
            color: #155588;
        }

        /* Content Sections */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .section-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            color: #155588;
        }

        /* Recent Applications Table */
        .applications-table {
            width: 100%;
            border-collapse: collapse;
        }

        .applications-table th {
            text-align: left;
            padding: 0.75rem;
            background: #f8f9fa;
            color: #666;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid #e1e8ed;
        }

        .applications-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e1e8ed;
        }

        .applications-table tr:hover {
            background: #f8f9fa;
        }

        .applicant-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .applicant-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.accepted {
            background: #d4edda;
            color: #27ae60;
        }

        .status-badge.rejected {
            background: #f8d7da;
            color: #dc3545;
        }

        /* Opportunities List */
        .opportunity-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
            transition: background 0.2s;
        }

        .opportunity-item:hover {
            background: #f8f9fa;
        }

        .opportunity-item:last-child {
            border-bottom: none;
        }

        .opportunity-title {
            font-weight: 600;
            color: #155588;
            margin-bottom: 0.25rem;
        }

        .opportunity-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .opportunity-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .opportunity-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Activity Feed */
        .activity-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            color: #333;
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #999;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #155588;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav-container">
            <nav>
                <a href="index.html" class="logo">
                    <img src="Images/CoveTalks_logo.svg" alt="CoveTalks" class="logo-img" onerror="this.style.display='none'">
                </a>
                
                <!-- Navigation links for Organization -->
                <ul class="nav-links" id="navLinks">
                    <li><a href="organization-dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="members.html">Find Speakers</a></li>
                    <li><a href="post-opportunity.html">Post Opportunity</a></li>
                    <li><a href="my-opportunities.html">My Opportunities</a></li>
                    <li><a href="saved-speakers.html">Saved Speakers</a></li>
                </ul>
    
                <div class="nav-right">
                    <!-- User menu -->
                    <div class="user-menu" id="userMenu">
                        <div class="user-avatar" id="userAvatar" onclick="toggleDropdown()">O</div>
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="inbox.html">Inbox</a>
                            <div class="dropdown-divider"></div>
                            <a href="settings.html">Settings</a>
                            <a href="billing.html">Billing</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="logout(); return false;">Logout</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <h1>Welcome back, <span id="orgName">Organization</span>!</h1>
                <p>Manage your speaking opportunities and connect with speakers</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📢</div>
                    <div class="stat-value" id="activeOpportunities">0</div>
                    <div class="stat-label">Active Opportunities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📝</div>
                    <div class="stat-value" id="totalApplications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⏳</div>
                    <div class="stat-value" id="pendingReviews">0</div>
                    <div class="stat-label">Pending Reviews</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-value" id="savedSpeakers">0</div>
                    <div class="stat-label">Saved Speakers</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h2>Quick Actions</h2>
                <div class="actions-grid">
                    <a href="post-opportunity.html" class="action-card">
                        <div class="action-icon">➕</div>
                        <div class="action-title">Post New Opportunity</div>
                    </a>
                    <a href="members.html" class="action-card">
                        <div class="action-icon">🔍</div>
                        <div class="action-title">Browse Speakers</div>
                    </a>
                    <a href="my-opportunities.html" class="action-card">
                        <div class="action-icon">📋</div>
                        <div class="action-title">Manage Opportunities</div>
                    </a>
                    <a href="saved-speakers.html" class="action-card">
                        <div class="action-icon">💾</div>
                        <div class="action-title">View Saved Speakers</div>
                    </a>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div>
                    <!-- Recent Applications -->
                    <div class="section-card">
                        <div class="section-header">
                            <h2>Recent Applications</h2>
                            <a href="my-opportunities.html" class="btn btn-primary">View All</a>
                        </div>
                        <div id="recentApplicationsContent">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading applications...
                            </div>
                        </div>
                    </div>

                    <!-- Active Opportunities -->
                    <div class="section-card" style="margin-top: 2rem;">
                        <div class="section-header">
                            <h2>Your Active Opportunities</h2>
                            <a href="post-opportunity.html" class="btn btn-success">Post New</a>
                        </div>
                        <div id="activeOpportunitiesContent">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading opportunities...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Recent Activity -->
                    <div class="section-card">
                        <h2>Recent Activity</h2>
                        <div id="recentActivityContent">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading activity...
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="section-card" style="margin-top: 2rem;">
                        <h2>This Month</h2>
                        <div id="monthlyStats">
                            <div class="opportunity-item">
                                <div class="opportunity-meta">
                                    <span>📝 New Applications: <strong id="monthApplications">0</strong></span>
                                </div>
                                <div class="opportunity-meta">
                                    <span>✅ Accepted: <strong id="monthAccepted">0</strong></span>
                                </div>
                                <div class="opportunity-meta">
                                    <span>👁 Profile Views: <strong id="monthViews">0</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Load Supabase from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Load config and Supabase client -->
    <script src="js/config.js"></script>
    <script src="js/supabase-client.js"></script>
    
    <script>
        // Page state
        let currentUser = null;
        let organizationData = null;

        // Wait for Supabase client
        function waitForSupabase(callback) {
            let attempts = 0;
            const maxAttempts = 10;
            
            function check() {
                attempts++;
                if (typeof window.covetalks !== 'undefined' && window.covetalks.supabase) {
                    callback();
                } else if (attempts < maxAttempts) {
                    setTimeout(check, 500);
                } else {
                    console.error('Failed to initialize Supabase client');
                    window.location.href = '/login.html';
                }
            }
            check();
        }

        // Initialize page
        async function initializePage() {
            waitForSupabase(async () => {
                try {
                    // Check authentication
                    const session = await window.covetalks.checkAuth();
                    if (!session) {
                        window.location.href = '/login.html';
                        return;
                    }

                    // Get user profile
                    currentUser = await window.covetalks.getMemberProfile(session.user.id);
                    if (!currentUser || currentUser.member_type !== 'Organization') {
                        // Redirect non-organization users to appropriate dashboard
                        window.location.href = '/dashboard.html';
                        return;
                    }

                    // Update UI with user info
                    updateUserInterface();

                    // Load dashboard data
                    await loadDashboardData();

                } catch (error) {
                    console.error('Initialization error:', error);
                    alert('Failed to load dashboard. Please try refreshing the page.');
                }
            });
        }

        // Update user interface
        function updateUserInterface() {
            // Update organization name
            document.getElementById('orgName').textContent = currentUser.name || 'Organization';
            
            // Update avatar
            const initials = currentUser.name ? 
                currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : 
                'O';
            document.getElementById('userAvatar').textContent = initials;
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load all data in parallel
                const [
                    opportunities,
                    savedSpeakers,
                    recentApplications,
                    recentActivity
                ] = await Promise.all([
                    loadOpportunities(),
                    loadSavedSpeakersCount(),
                    loadRecentApplications(),
                    loadRecentActivity()
                ]);

                // Update stats
                updateDashboardStats(opportunities, recentApplications);

                // Display active opportunities
                displayActiveOpportunities(opportunities);

                // Display recent applications
                displayRecentApplications(recentApplications);

                // Display recent activity
                displayRecentActivity(recentActivity);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load opportunities
        async function loadOpportunities() {
            try {
                const opportunities = await window.covetalks.getMyOpportunities();
                return opportunities || [];
            } catch (error) {
                console.error('Error loading opportunities:', error);
                return [];
            }
        }

        // Load saved speakers count
        async function loadSavedSpeakersCount() {
            try {
                const savedSpeakers = await window.covetalks.getSavedSpeakers();
                document.getElementById('savedSpeakers').textContent = savedSpeakers.length;
                return savedSpeakers.length;
            } catch (error) {
                console.error('Error loading saved speakers:', error);
                return 0;
            }
        }

        // Load recent applications
        async function loadRecentApplications() {
            try {
                const opportunities = await window.covetalks.getMyOpportunities();
                let allApplications = [];
                
                // Get applications for each opportunity
                for (const opp of opportunities.slice(0, 5)) { // Limit to recent 5 opportunities
                    const applications = await window.covetalks.getOpportunityApplications(opp.id);
                    allApplications = allApplications.concat(
                        applications.map(app => ({ ...app, opportunity: opp }))
                    );
                }
                
                // Sort by created_at and limit to recent 10
                allApplications.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                return allApplications.slice(0, 10);
            } catch (error) {
                console.error('Error loading applications:', error);
                return [];
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const activity = await window.covetalks.getRecentActivity(currentUser.id, 10);
                return activity || [];
            } catch (error) {
                console.error('Error loading activity:', error);
                return [];
            }
        }

        // Update dashboard stats
        function updateDashboardStats(opportunities, applications) {
            // Active opportunities
            const activeOps = opportunities.filter(o => o.status === 'Open').length;
            document.getElementById('activeOpportunities').textContent = activeOps;
            
            // Total applications
            document.getElementById('totalApplications').textContent = applications.length;
            
            // Pending reviews
            const pendingCount = applications.filter(a => a.status === 'Pending').length;
            document.getElementById('pendingReviews').textContent = pendingCount;
            
            // Monthly stats
            const now = new Date();
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            const monthlyApps = applications.filter(a => 
                new Date(a.created_at) >= monthStart
            );
            
            document.getElementById('monthApplications').textContent = monthlyApps.length;
            document.getElementById('monthAccepted').textContent = 
                monthlyApps.filter(a => a.status === 'Accepted').length;
        }

        // Display active opportunities
        function displayActiveOpportunities(opportunities) {
            const container = document.getElementById('activeOpportunitiesContent');
            const activeOps = opportunities.filter(o => o.status === 'Open').slice(0, 5);
            
            if (activeOps.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📢</div>
                        <p>No active opportunities</p>
                        <a href="post-opportunity.html" class="btn btn-primary" style="margin-top: 1rem;">
                            Post Your First Opportunity
                        </a>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activeOps.map(opp => `
                <div class="opportunity-item">
                    <div class="opportunity-title">${opp.title}</div>
                    <div class="opportunity-meta">
                        <span>📅 ${formatDate(opp.event_date)}</span>
                        <span>📍 ${opp.location || 'TBD'}</span>
                    </div>
                    <div class="opportunity-stats">
                        <div class="opportunity-stat">
                            <span>📝</span>
                            <span>${opp.applications?.count || 0} applications</span>
                        </div>
                        <div class="opportunity-stat">
                            <span>💰</span>
                            <span>${opp.compensation_amount ? `$${opp.compensation_amount}` : 'Volunteer'}</span>
                        </div>
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <a href="opportunity-details.html?id=${opp.id}" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                            View Details
                        </a>
                    </div>
                </div>
            `).join('');
        }

        // Display recent applications
        function displayRecentApplications(applications) {
            const container = document.getElementById('recentApplicationsContent');
            
            if (applications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📝</div>
                        <p>No applications yet</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">
                            Applications will appear here when speakers apply to your opportunities
                        </p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <table class="applications-table">
                    <thead>
                        <tr>
                            <th>Speaker</th>
                            <th>Opportunity</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${applications.slice(0, 5).map(app => {
                            const speaker = app.speaker || {};
                            const initials = speaker.name ? 
                                speaker.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : 
                                '?';
                            
                            const statusClass = app.status.toLowerCase();
                            
                            return `
                                <tr>
                                    <td>
                                        <div class="applicant-info">
                                            <div class="applicant-avatar">${initials}</div>
                                            <div>
                                                <div>${speaker.name || 'Unknown'}</div>
                                                <div style="font-size: 0.85rem; color: #666;">
                                                    ${speaker.location || 'Location not specified'}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>${app.opportunity?.title || 'Unknown'}</td>
                                    <td>
                                        <span class="status-badge ${statusClass}">${app.status}</span>
                                    </td>
                                    <td>
                                        <a href="application-review.html?id=${app.id}" class="btn btn-primary" 
                                           style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                            Review
                                        </a>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        // Display recent activity
        function displayRecentActivity(activities) {
            const container = document.getElementById('recentActivityContent');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📊</div>
                        <p>No recent activity</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activities.slice(0, 5).map(activity => {
                const icon = getActivityIcon(activity.activity_type);
                const text = getActivityText(activity);
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-text">${text}</div>
                            <div class="activity-time">${formatTimeAgo(activity.created_at)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get activity icon
        function getActivityIcon(type) {
            const icons = {
                'opportunity_posted': '📢',
                'application_received': '📝',
                'application_reviewed': '✅',
                'speaker_saved': '⭐',
                'profile_view': '👁',
                'default': '📌'
            };
            return icons[type] || icons.default;
        }

        // Get activity text
        function getActivityText(activity) {
            const texts = {
                'opportunity_posted': 'Posted a new opportunity',
                'application_received': 'Received a new application',
                'application_reviewed': 'Reviewed an application',
                'speaker_saved': 'Saved a speaker',
                'profile_view': 'Someone viewed your profile'
            };
            return texts[activity.activity_type] || 'New activity';
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'Date TBD';
            return new Date(dateString).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        // Format time ago
        function formatTimeAgo(dateString) {
            if (!dateString) return 'Recently';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays < 30) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            return formatDate(dateString);
        }

        // Toggle dropdown
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('dropdownMenu');
            const avatar = document.getElementById('userAvatar');
            
            if (!avatar.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Logout
        async function logout() {
            if (window.covetalks) {
                await window.covetalks.logout();
            }
        }

        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }
    </script>
</body>
</html>