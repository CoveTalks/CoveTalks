<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - CoveTalks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: white;
            color: #333;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }
        
        .logo-img {
            height: 70px;
            width: auto;
            display: block;
        }
        
        @media (max-width: 768px) {
            .logo-img {
                height: 50px;
            }
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #155588;
        }

        .nav-links a.active {
            color: #155588;
            border-bottom: 2px solid #155588;
            padding-bottom: 2px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .user-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            padding: 1rem 0;
            min-width: 200px;
            display: none;
            margin-top: 0.5rem;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.5rem 1.5rem;
            color: #333;
            text-decoration: none;
            transition: background 0.3s;
        }

        .dropdown-menu a:hover {
            background: #f8f9fa;
        }

        .dropdown-divider {
            border-top: 1px solid #e1e8ed;
            margin: 0.5rem 0;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
            font-weight: 500;
            text-align: center;
        }

        .btn-primary {
            background: #155588;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3d6f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: #155588;
            border: 2px solid #155588;
        }

        .btn-secondary:hover {
            background: #155588;
            color: white;
        }

        /* Profile Header */
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #1e93b7 100%);
            padding: 8rem 0 4rem;
            color: white;
        }

        .profile-header-content {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .profile-image-container {
            flex-shrink: 0;
        }

        .profile-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            object-fit: cover;
            background: white;
        }

        .profile-image-placeholder {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #667eea, #1e93b7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            font-weight: bold;
            color: white;
        }

        /* Organization specific image styling */
        .organization-image {
            border-radius: 20px; /* Square with rounded corners for organizations */
        }

        .organization-image-placeholder {
            border-radius: 20px;
            background: linear-gradient(135deg, #f2b236, #f2b236);
        }

        .profile-info h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .profile-type {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .profile-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .profile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-content {
            padding: 3rem 0;
            min-height: 50vh;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-top: -4rem;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .content-card h2 {
            color: #155588;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e1e8ed;
        }

        .bio-section p {
            margin-bottom: 1rem;
            line-height: 1.8;
            color: #555;
        }

        .expertise-list {
            list-style: none;
        }

        .expertise-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
        }

        .expertise-list li:before {
            content: "‚úì";
            color: #f2b236;
            font-weight: bold;
            margin-right: 1rem;
        }

        .contact-card {
            position: sticky;
            top: 6rem;
        }

        .contact-info {
            margin-bottom: 1.5rem;
        }

        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .contact-item:last-child {
            border-bottom: none;
        }

        .contact-icon {
            width: 40px;
            height: 40px;
            background: #e8f4fd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #155588;
            flex-shrink: 0;
        }

        .contact-item a {
            color: #155588;
            text-decoration: none;
        }

        .contact-item a:hover {
            text-decoration: underline;
        }

        .booking-cta {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #1e93b7 100%);
            border-radius: 10px;
            color: white;
        }

        .booking-cta h3 {
            margin-bottom: 1rem;
        }

        .booking-cta p {
            margin-bottom: 1.5rem;
        }

        .btn-white {
            background: white;
            color: #155588;
            font-weight: bold;
        }

        .btn-white:hover {
            background: #f8f9fa;
        }

        /* Organization-specific CTA */
        .contact-cta {
            background: linear-gradient(135deg, #f2b236 0%, #f2b236 100%);
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #155588;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Organization Members Section */
        .members-section {
            margin-top: 1rem;
        }

        .member-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .member-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .member-info {
            flex-grow: 1;
        }

        .member-name {
            font-weight: bold;
            color: #155588;
            margin-bottom: 0.25rem;
        }

        .member-role {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .member-contact {
            display: flex;
            gap: 1rem;
        }

        .member-contact a {
            color: #155588;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .member-contact a:hover {
            text-decoration: underline;
        }

        .no-members {
            text-align: center;
            padding: 2rem;
            color: #999;
            font-style: italic;
        }

        /* Reviews Section */
        .reviews-section {
            margin-top: 1rem;
        }

        .review-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .reviewer-name {
            font-weight: bold;
            color: #155588;
        }

        .review-rating {
            color: #f2b236;
        }

        .review-text {
            color: #666;
            line-height: 1.6;
        }

        .no-reviews {
            text-align: center;
            padding: 2rem;
            color: #999;
            font-style: italic;
        }

        /* Premium Blur */
        .premium-blur {
            filter: blur(5px);
            pointer-events: none;
        }

        .upgrade-overlay {
            background: rgba(44, 90, 160, 0.95);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin-top: -3rem;
        }

        /* Organization Information Section */
        .org-info-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .org-info-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
        }

        .org-info-title {
            font-weight: bold;
            color: #155588;
            margin-bottom: 0.5rem;
        }

        .org-info-value {
            color: #666;
        }

        /* Mobile Navigation */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 35px;
            height: 35px;
            cursor: pointer;
            z-index: 1002;
            background: none;
            border: none;
            padding: 5px;
        }

        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: #333;
            margin: 3px 0;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            right: -320px;
            width: 300px;
            height: 100vh;
            background: white;
            z-index: 1001;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
        }

        .mobile-nav-links {
            list-style: none;
            padding: 1rem 0;
        }

        .mobile-nav-links a {
            display: block;
            padding: 1rem 1.5rem;
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none !important;
            }
            
            .auth-buttons.desktop-only {
                display: none !important;
            }
            
            .hamburger {
                display: flex;
            }

            .profile-header-content {
                flex-direction: column;
                text-align: center;
            }

            .profile-image, .profile-image-placeholder {
                width: 150px;
                height: 150px;
            }

            .organization-image, .organization-image-placeholder {
                width: 150px;
                height: 150px;
            }

            .profile-info h1 {
                font-size: 2rem;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .org-info-section {
                grid-template-columns: 1fr;
            }

            .member-card {
                flex-direction: column;
                text-align: center;
            }

            .contact-card {
                position: static;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #155588;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav-container">
            <nav>
                <!-- Logo -->
                <a href="index.html" class="logo">
                    <img src="/Images/CoveTalks_logo.svg" alt="CoveTalks" class="logo-img">
                </a>
                
                <!-- Desktop Navigation -->
                <ul class="nav-links nav-logged-out" id="navLoggedOut">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="members.html">Find Speakers</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="register.html">Register</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
                
                <ul class="nav-links nav-logged-in nav-speaker" id="navSpeaker" style="display: none;">
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="members.html">Find Speakers</a></li>
                    <li><a href="opportunities.html">Opportunities</a></li>
                    <li><a href="bookings.html">My Bookings</a></li>
                    <li><a href="profile.html" class="active">Profile</a></li>
                </ul>
                
                <ul class="nav-links nav-logged-in nav-organization" id="navOrganization" style="display: none;">
                    <li><a href="organization-dashboard.html">Dashboard</a></li>
                    <li><a href="members.html">Find Speakers</a></li>
                    <li><a href="post-opportunity.html">Post Opportunity</a></li>
                    <li><a href="my-opportunities.html">My Opportunities</a></li>
                    <li><a href="saved-speakers.html">Saved Speakers</a></li>
                </ul>

                <!-- Right Side Navigation -->
                <div class="nav-right">
                    <div class="user-menu" id="userMenuDesktop" style="display: none;">
                        <div class="user-dropdown">
                            <div class="user-avatar" onclick="toggleDropdown()" id="userAvatar">JD</div>
                            <div class="dropdown-menu" id="dropdownMenu">
                                <a href="profile-edit.html">Edit Profile</a>
                                <a href="settings.html">Settings</a>
                                <a href="billing.html">Billing</a>
                                <div class="dropdown-divider"></div>
                                <a href="#" onclick="logout()">Logout</a>
                            </div>
                        </div>
                    </div>

                    <div class="auth-buttons desktop-only" id="authButtonsDesktop">
                        <a href="register.html" class="btn btn-secondary">Join</a>
                        <a href="login.html" class="btn btn-primary">Login</a>
                    </div>

                    <button class="hamburger" id="hamburger" onclick="toggleMobileMenu()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="container">
            <div class="profile-header-content">
                <div class="profile-image-container">
                    <div id="profileImageContainer">
                        <div class="profile-image-placeholder">
                            <span class="loading"></span>
                        </div>
                    </div>
                </div>
                <div class="profile-info">
                    <h1 id="profileName">Loading...</h1>
                    <div class="profile-type" id="profileType">Loading...</div>
                    <div class="profile-location" id="profileLocation">
                        <span>üìç</span>
                        <span>Loading...</span>
                    </div>
                    <div class="profile-tags" id="profileTags">
                        <!-- Tags will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="content-grid">
                <!-- Left Column -->
                <div>
                    <!-- Bio/About Section -->
                    <div class="content-card bio-section">
                        <h2 id="aboutTitle">About</h2>
                        <p id="profileBio">Loading profile information...</p>
                    </div>

                    <!-- Dynamic Section - Areas of Expertise OR Speaking Topics -->
                    <div class="content-card" style="margin-top: 2rem;" id="expertiseSection">
                        <h2 id="expertiseTitle">Areas of Expertise</h2>
                        <ul class="expertise-list" id="expertiseList">
                            <!-- Expertise/Topics will be inserted here -->
                        </ul>
                    </div>

                    <!-- Organization Information (Organizations only) -->
                    <div class="content-card" style="margin-top: 2rem; display: none;" id="orgInfoSection">
                        <h2>Organization Information</h2>
                        <div class="org-info-section" id="orgInfoGrid">
                            <!-- Organization details will be inserted here -->
                        </div>
                    </div>

                    <!-- Stats Section (Speakers) OR Members Section (Organizations) -->
                    <div class="content-card" style="margin-top: 2rem;" id="statsOrMembersSection">
                        <!-- Content will be dynamically generated -->
                    </div>

                    <!-- Reviews Section (Speakers only) -->
                    <div class="content-card" style="margin-top: 2rem;" id="reviewsCard">
                        <h2>Recent Reviews</h2>
                        <div class="reviews-section" id="reviewsSection">
                            <!-- Reviews will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <div class="content-card contact-card">
                        <h2>Contact Information</h2>
                        <div id="contactInfo">
                            <!-- Contact info will be inserted here based on auth status -->
                        </div>
                        
                        <div id="ctaSection">
                            <!-- CTA will be dynamically generated based on profile type -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Include the API client and navigation -->
    <script src="/js/app.js"></script>
    <script src="/js/navigation.js"></script>

    <script>
        // Global variables
        let profileData = null;
        let isOwnProfile = false;
        let profileType = null; // 'Speaker' or 'Organization'

        // Wait for API to be fully loaded
        function waitForAPI(callback) {
            if (typeof api !== 'undefined' && typeof updateNavigation !== 'undefined') {
                callback();
            } else {
                setTimeout(() => waitForAPI(callback), 50);
            }
        }

        // Initialize page
        function initializePage() {
            // Get profile ID from URL or use current user's ID
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');
            
            // Check if viewing own profile
            const currentUser = api.getCurrentUser();
            if (!profileId && currentUser) {
                // No ID provided, show current user's profile
                isOwnProfile = true;
                loadProfile();
            } else if (profileId) {
                // Specific profile ID provided
                isOwnProfile = currentUser && currentUser.id === profileId;
                loadProfile(profileId);
            } else {
                // No ID and not logged in
                showError('No profile specified');
            }
        }

        // Load profile
        async function loadProfile(profileId = null) {
            try {
                console.log('[Profile] Loading profile...');
                
                // Use the API client to get profile
                const response = await api.getProfile(profileId);
                
                console.log('[Profile] Response:', response);
                
                if (response && response.profile) {
                    profileData = response.profile;
                    profileType = response.profile.memberType;
                    displayProfile(profileData);
                } else {
                    showError('Profile not found');
                }
            } catch (error) {
                console.error('[Profile] Error loading profile:', error);
                showError('Failed to load profile');
            }
        }

        // Display profile data
        function displayProfile(profile) {
            console.log('[Profile] Displaying profile:', profile);
            
            // Update page title
            document.title = `${profile.name || 'Profile'} - CoveTalks`;
            
            // Profile Image
            displayProfileImage(profile);
            
            // Basic Info
            document.getElementById('profileName').textContent = profile.name || 'Unknown';
            document.getElementById('profileLocation').innerHTML = `<span>üìç</span><span>${profile.location || 'Location not specified'}</span>`;
            
            // Bio
            displayBio(profile);
            
            // Display content based on profile type
            if (profile.memberType === 'Organization') {
                displayOrganizationProfile(profile);
            } else {
                displaySpeakerProfile(profile);
            }
            
            // Contact Information
            displayContactInfo(profile);
            
            // CTA Section
            displayCTA(profile);
        }

        // Display profile image
        function displayProfileImage(profile) {
            const imageContainer = document.getElementById('profileImageContainer');
            const isOrganization = profile.memberType === 'Organization';
            const initials = getInitials(profile.name);
            
            if (profile.profileImage) {
                const imgClass = isOrganization ? 'profile-image organization-image' : 'profile-image';
                const placeholderClass = isOrganization ? 'profile-image-placeholder organization-image-placeholder' : 'profile-image-placeholder';
                
                imageContainer.innerHTML = `
                    <img src="${profile.profileImage}" alt="${profile.name}" class="${imgClass}" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                    <div class="${placeholderClass}" style="display:none;">${initials}</div>
                `;
            } else {
                const placeholderClass = isOrganization ? 'profile-image-placeholder organization-image-placeholder' : 'profile-image-placeholder';
                imageContainer.innerHTML = `<div class="${placeholderClass}">${initials}</div>`;
            }
        }

        // Display bio section
        function displayBio(profile) {
            const bioElement = document.getElementById('profileBio');
            
            // For organizations, use org bio; for speakers, use member bio
            const bio = profile.memberType === 'Organization' ? profile.orgBio : profile.bio;
            
            if (bio) {
                bioElement.textContent = bio;
            } else {
                bioElement.innerHTML = '<em>No description available</em>';
            }
        }

        // Display Speaker Profile
        function displaySpeakerProfile(profile) {
            // Profile type badge
            document.getElementById('profileType').textContent = 'Speaker';
            
            // Speaker tags (specialty)
            const tags = profile.specialty || [];
            const tagsContainer = document.getElementById('profileTags');
            if (tags.length > 0) {
                tagsContainer.innerHTML = tags.map(tag => `<span class="tag">${tag}</span>`).join('');
            } else {
                tagsContainer.innerHTML = '<span class="tag">No specialties listed</span>';
            }

            // Areas of Expertise
            document.getElementById('expertiseTitle').textContent = 'Areas of Expertise';
            const expertiseList = document.getElementById('expertiseList');
            if (tags.length > 0) {
                expertiseList.innerHTML = tags.map(tag => `<li>${tag}</li>`).join('');
            } else {
                expertiseList.innerHTML = '<li style="color: #999; font-style: italic;">No areas of expertise specified</li>';
            }

            // Hide organization sections
            document.getElementById('orgInfoSection').style.display = 'none';

            // Speaker Statistics
            displaySpeakerStats(profile);

            // Reviews (show for speakers)
            document.getElementById('reviewsCard').style.display = 'block';
            displayReviews(profile.reviews || []);
        }

        // Display Organization Profile
        function displayOrganizationProfile(profile) {
            // Profile type badge - show organization type (will come from org data)
            document.getElementById('profileType').textContent = profile.organizationType || 'Organization';
            
            // No tags for organizations - remove speaking topics section
            const tagsContainer = document.getElementById('profileTags');
            tagsContainer.style.display = 'none';

            // Hide expertise section for organizations - they don't have speaking topics
            document.getElementById('expertiseSection').style.display = 'none';

            // Hide organization info section - we don't need it
            document.getElementById('orgInfoSection').style.display = 'none';

            // Organization Members (ONLY Speakers associated with this org)
            displayOrganizationMembers(profile);

            // Hide reviews for organizations
            document.getElementById('reviewsCard').style.display = 'none';
        }

        // Display speaker statistics
        function displaySpeakerStats(profile) {
            const statsSection = document.getElementById('statsOrMembersSection');
            
            statsSection.innerHTML = `
                <h2>Speaker Statistics</h2>
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number" id="statBookings">${profile.totalBookings || 0}</div>
                        <div class="stat-label">Speaking Events</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statRating">${profile.averageRating || '0.0'}</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statReviews">${profile.totalReviews || 0}</div>
                        <div class="stat-label">Reviews</div>
                    </div>
                </div>
            `;
        }

        // Display organization members (speakers only)
        function displayOrganizationMembers(profile) {
            const statsSection = document.getElementById('statsOrMembersSection');
            
            statsSection.innerHTML = `
                <h2>Associated Speakers</h2>
                <div class="members-section" id="membersSection">
                    <!-- Speakers will be loaded here -->
                </div>
            `;
            
            loadOrganizationMembers(profile);
        }

        // Load organization members - ONLY Speakers associated with this organization
        async function loadOrganizationMembers(profile) {
            const membersSection = document.getElementById('membersSection');
            
            // Show loading state
            membersSection.innerHTML = '<div style="text-align: center; padding: 2rem;"><span class="loading"></span> Loading speakers...</div>';
            
            try {
                console.log('[Profile] Loading speakers for organization ID:', profile.organizationId);
                
                // Make sure we have an organization ID
                if (!profile.organizationId) {
                    console.log('[Profile] No organization ID available');
                    displayNoSpeakers();
                    return;
                }
                
                // Get speakers associated with this organization
                const speakersResponse = await fetch(`/.netlify/functions/organization-speakers?orgId=${profile.organizationId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${api.getToken()}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (speakersResponse.ok) {
                    const speakersData = await speakersResponse.json();
                    console.log('[Profile] Speakers data:', speakersData);
                    
                    if (speakersData.success && speakersData.speakers && speakersData.speakers.length > 0) {
                        displaySpeakersData(speakersData.speakers);
                    } else {
                        console.log('[Profile] No speakers found');
                        displayNoSpeakers();
                    }
                } else {
                    console.log('[Profile] Speakers API call failed, status:', speakersResponse.status);
                    displayNoSpeakers();
                }
            } catch (error) {
                console.error('[Profile] Error loading organization speakers:', error);
                displayNoSpeakers();
            }
        }
        
        // Display speakers data from API
        function displaySpeakersData(speakers) {
            const membersSection = document.getElementById('membersSection');
            
            const speakersHtml = speakers.map(speaker => `
                <div class="member-card">
                    <div class="member-avatar">${getInitials(speaker.name)}</div>
                    <div class="member-info">
                        <div class="member-name">
                            <a href="profile.html?id=${speaker.id}" style="color: #155588; text-decoration: none;">
                                ${speaker.name}
                            </a>
                        </div>
                        <div class="member-role">Speaker</div>
                        <div class="member-contact">
                            ${speaker.email ? `<a href="mailto:${speaker.email}">Email</a>` : ''}
                            ${speaker.phone ? `<a href="tel:${speaker.phone}">Call</a>` : ''}
                            <a href="profile.html?id=${speaker.id}">View Profile</a>
                        </div>
                    </div>
                </div>
            `).join('');
            
            membersSection.innerHTML = speakersHtml;
        }
        
        // Display no speakers message
        function displayNoSpeakers() {
            const membersSection = document.getElementById('membersSection');
            membersSection.innerHTML = '<div class="no-members">No speakers associated with this organization</div>';
        }

        // Display reviews (speakers only)
        function displayReviews(reviews) {
            const reviewsSection = document.getElementById('reviewsSection');
            
            if (!reviews || reviews.length === 0) {
                reviewsSection.innerHTML = '<div class="no-reviews">No reviews yet!</div>';
                return;
            }
            
            const reviewsHtml = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <span class="reviewer-name">${review.organizationName || 'Anonymous'}</span>
                        <span class="review-rating">${'‚≠ê'.repeat(review.rating || 5)}</span>
                    </div>
                    <p class="review-text">${review.reviewText || 'No review text provided'}</p>
                </div>
            `).join('');
            
            reviewsSection.innerHTML = reviewsHtml;
        }

        // Display contact information based on auth status
        function displayContactInfo(profile) {
            const contactInfo = document.getElementById('contactInfo');
            const isAuthenticated = api.isAuthenticated();
            
            if (isAuthenticated) {
                // User is logged in - show contact information
                let contactHtml = '<div class="contact-info">';
                
                // For organizations, use organization data; for speakers, use member data
                const email = profile.memberType === 'Organization' ? profile.orgEmail : profile.email;
                const phone = profile.memberType === 'Organization' ? profile.orgPhone : profile.phone;
                const organizationType = profile.organizationType;
                const address = profile.address;
                
                if (email) {
                    contactHtml += `
                        <div class="contact-item">
                            <div class="contact-icon">‚úâÔ∏è</div>
                            <div>
                                <div style="color: #666; font-size: 0.9rem;">Email</div>
                                <div><a href="mailto:${email}">${email}</a></div>
                            </div>
                        </div>
                    `;
                }
                
                if (phone) {
                    contactHtml += `
                        <div class="contact-item">
                            <div class="contact-icon">üìû</div>
                            <div>
                                <div style="color: #666; font-size: 0.9rem;">Phone</div>
                                <div><a href="tel:${phone}">${phone}</a></div>
                            </div>
                        </div>
                    `;
                }
                
                // Add organization type for organizations
                if (profile.memberType === 'Organization' && organizationType) {
                    contactHtml += `
                        <div class="contact-item">
                            <div class="contact-icon">üè¢</div>
                            <div>
                                <div style="color: #666; font-size: 0.9rem;">Organization Type</div>
                                <div>${organizationType}</div>
                            </div>
                        </div>
                    `;
                }
                
                // Add address for organizations
                if (profile.memberType === 'Organization' && address) {
                    contactHtml += `
                        <div class="contact-item">
                            <div class="contact-icon">üìç</div>
                            <div>
                                <div style="color: #666; font-size: 0.9rem;">Address</div>
                                <div>${address}</div>
                            </div>
                        </div>
                    `;
                }
                
                if (profile.website) {
                    contactHtml += `
                        <div class="contact-item">
                            <div class="contact-icon">üåê</div>
                            <div>
                                <div style="color: #666; font-size: 0.9rem;">Website</div>
                                <div><a href="${profile.website}" target="_blank">Visit Website</a></div>
                            </div>
                        </div>
                    `;
                }
                
                contactHtml += '</div>';
                contactInfo.innerHTML = contactHtml;
            } else {
                // User is not logged in - show blur and upgrade prompt
                const orgTypeField = profile.memberType === 'Organization' ? 
                    '<div class="contact-item"><div class="contact-icon">üè¢</div><div>Type: ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div></div>' : '';
                const addressField = profile.memberType === 'Organization' ? 
                    '<div class="contact-item"><div class="contact-icon">üìç</div><div>Address: ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div></div>' : '';
                
                contactInfo.innerHTML = `
                    <div class="contact-info premium-blur">
                        <div class="contact-item">
                            <div class="contact-icon">‚úâÔ∏è</div>
                            <div>Email: ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢@email.com</div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìû</div>
                            <div>Phone: ‚Ä¢‚Ä¢‚Ä¢-‚Ä¢‚Ä¢‚Ä¢-‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                        </div>
                        ${orgTypeField}
                        ${addressField}
                    </div>
                    <div class="upgrade-overlay">
                        <h3>Premium Feature</h3>
                        <p>Contact information is available to registered members only</p>
                        <a href="login.html" class="btn btn-secondary" style="margin-top: 1rem;">Login to View</a>
                    </div>
                `;
            }
        }

        // Display CTA section
        function displayCTA(profile) {
            const ctaSection = document.getElementById('ctaSection');
            const isAuthenticated = api.isAuthenticated();
            
            if (profile.memberType === 'Organization') {
                // Organizations get a contact CTA
                ctaSection.innerHTML = `
                    <div class="booking-cta contact-cta" style="margin-top: 2rem;">
                        <h3>Contact Organization</h3>
                        <p>Get in touch to discuss speaking opportunities</p>
                        <button id="contactBtn" class="btn btn-white" style="width: 100%;">
                            Send Message
                        </button>
                    </div>
                `;
                
                // Setup contact button
                document.getElementById('contactBtn').onclick = () => {
                    if (isAuthenticated && profile.email) {
                        window.location.href = `mailto:${profile.email}?subject=Speaking Opportunity Inquiry`;
                    } else if (!isAuthenticated) {
                        alert('Please log in to contact this organization');
                        window.location.href = 'login.html';
                    } else {
                        alert('No contact method available for this organization');
                    }
                };
            } else {
                // Speakers get a booking CTA
                ctaSection.innerHTML = `
                    <div class="booking-cta" style="margin-top: 2rem;">
                        <h3>Book This Speaker</h3>
                        <p>Ready to bring expertise to your event?</p>
                        <button id="bookingBtn" class="btn btn-white" style="width: 100%;">
                            Request Booking
                        </button>
                    </div>
                `;
                
                // Setup booking button
                document.getElementById('bookingBtn').onclick = () => {
                    if (isAuthenticated && profile.bookingLink) {
                        window.open(profile.bookingLink, '_blank');
                    } else if (isAuthenticated && profile.email) {
                        window.location.href = `mailto:${profile.email}?subject=Speaking Request for ${profile.name}`;
                    } else if (!isAuthenticated) {
                        alert('Please log in to request a booking');
                        window.location.href = 'login.html';
                    } else {
                        alert('No booking method available for this speaker');
                    }
                };
            }
        }

        // Get initials from name
        function getInitials(name) {
            if (!name) return 'U';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        // Show error message
        function showError(message) {
            document.getElementById('profileBio').innerHTML = `<em style="color: #dc3545;">${message}</em>`;
            document.getElementById('profileName').textContent = 'Error';
            document.getElementById('profileLocation').innerHTML = '<span>üìç</span><span>N/A</span>';
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            // Implementation for mobile menu
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }

        function logout() {
            api.logout();
        }

        // Main initialization
        document.addEventListener('DOMContentLoaded', function() {
            waitForAPI(function() {
                console.log('[Profile] API and navigation ready');
                updateNavigation();
                initializePage();
            });
        });
    </script>
</body>
</html>