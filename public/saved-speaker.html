<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Speakers - CoveTalks</title>
    <link rel="icon" type="image/svg+xml" href="/Images/CoveTalks_Vertical.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: white;
            color: #333;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
        }
        
        .logo-img {
            height: 70px;
            width: auto;
            display: block;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #155588;
        }

        .nav-links a.active {
            color: #155588;
            border-bottom: 2px solid #155588;
            padding-bottom: 2px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
            font-weight: 500;
            text-align: center;
        }

        .btn-primary {
            background: #155588;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3d6f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: #155588;
            border: 2px solid #155588;
        }

        .btn-secondary:hover {
            background: #155588;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 200px;
            display: none;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1.25rem;
            color: #333;
            text-decoration: none;
            transition: background 0.2s;
        }

        .dropdown-menu a:hover {
            background: #f8f9fa;
        }

        .dropdown-divider {
            height: 1px;
            background: #e1e8ed;
            margin: 0;
        }

        /* Main Content */
        .main-content {
            padding-top: 6rem;
            padding-bottom: 3rem;
            min-height: 100vh;
        }

        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #1e93b7 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Stats Bar */
        .stats-bar {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #155588;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Actions Bar */
        .actions-bar {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .search-filters {
            display: flex;
            gap: 1rem;
            flex: 1;
            min-width: 300px;
        }

        .search-box {
            flex: 1;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #155588;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #155588;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 0.25rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Speakers Grid */
        .speakers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Speaker Card */
        .speaker-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .speaker-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .saved-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #ffc107;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .speaker-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .speaker-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #1e93b7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin-right: 1rem;
            overflow: hidden;
        }

        .speaker-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .speaker-info h3 {
            color: #155588;
            margin-bottom: 0.25rem;
        }

        .speaker-location {
            color: #666;
            font-size: 0.9rem;
        }

        .speaker-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.25rem;
        }

        .stars {
            color: #ffc107;
        }

        .rating-value {
            color: #666;
            font-size: 0.9rem;
        }

        .speaker-bio {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .speaker-specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .specialty-tag {
            background: #e8f4fd;
            color: #155588;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        /* Notes Section */
        .speaker-notes {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .notes-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .edit-notes-btn {
            background: none;
            border: none;
            color: #155588;
            cursor: pointer;
            font-size: 0.85rem;
            text-decoration: underline;
        }

        .notes-content {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .notes-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e1e8ed;
            border-radius: 5px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 60px;
        }

        .notes-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Card Actions */
        .card-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: space-between;
        }

        /* List View */
        .speakers-list {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .speakers-table {
            width: 100%;
            border-collapse: collapse;
        }

        .speakers-table th {
            text-align: left;
            padding: 1rem;
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            border-bottom: 2px solid #e1e8ed;
        }

        .speakers-table td {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
        }

        .speakers-table tr:hover {
            background: #f8f9fa;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #155588;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            color: #155588;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #155588;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .page-header h1 {
                font-size: 1.8rem;
            }

            .stats-bar {
                flex-direction: column;
                gap: 1rem;
            }

            .actions-bar {
                flex-direction: column;
            }

            .search-filters {
                flex-direction: column;
                width: 100%;
            }

            .speakers-grid {
                grid-template-columns: 1fr;
            }

            .speakers-table {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav-container">
            <nav>
                <a href="index.html" class="logo">
                    <img src="Images/CoveTalks_logo.svg" alt="CoveTalks" class="logo-img" onerror="this.style.display='none'">
                </a>
                
                <!-- Navigation links for Organization -->
                <ul class="nav-links" id="navLinks">
                    <li><a href="organization-dashboard.html">Dashboard</a></li>
                    <li><a href="members.html">Find Speakers</a></li>
                    <li><a href="post-opportunity.html">Post Opportunity</a></li>
                    <li><a href="my-opportunities.html">My Opportunities</a></li>
                    <li><a href="saved-speakers.html" class="active">Saved Speakers</a></li>
                </ul>
    
                <div class="nav-right">
                    <!-- User menu -->
                    <div class="user-menu" id="userMenu">
                        <div class="user-avatar" id="userAvatar" onclick="toggleDropdown()">O</div>
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="inbox.html">Inbox</a>
                            <div class="dropdown-divider"></div>
                            <a href="settings.html">Settings</a>
                            <a href="billing.html">Billing</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="logout(); return false;">Logout</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>Saved Speakers</h1>
                <p>Manage your collection of saved speakers for future opportunities</p>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalSaved">0</div>
                    <div class="stat-label">Total Saved</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="withNotes">0</div>
                    <div class="stat-label">With Notes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="recentlyAdded">0</div>
                    <div class="stat-label">Added This Month</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="topRated">0</div>
                    <div class="stat-label">5-Star Speakers</div>
                </div>
            </div>

            <!-- Actions Bar -->
            <div class="actions-bar">
                <div class="search-filters">
                    <div class="search-box">
                        <span class="search-icon">🔍</span>
                        <input type="text" id="searchInput" placeholder="Search saved speakers..." onkeyup="filterSpeakers()">
                    </div>
                    <select class="filter-select" id="specialtyFilter" onchange="filterSpeakers()">
                        <option value="">All Specialties</option>
                        <option value="Leadership">Leadership</option>
                        <option value="Technology">Technology</option>
                        <option value="Health">Health & Wellness</option>
                        <option value="Business">Business</option>
                        <option value="Education">Education</option>
                        <option value="Motivation">Motivation</option>
                    </select>
                    <select class="filter-select" id="sortBy" onchange="sortSpeakers()">
                        <option value="recent">Recently Added</option>
                        <option value="name">Name (A-Z)</option>
                        <option value="rating">Highest Rated</option>
                        <option value="location">Location</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('grid')">Grid</button>
                        <button class="view-btn" onclick="setView('list')">List</button>
                    </div>
                    <button onclick="exportSpeakers()" class="btn btn-secondary">
                        📥 Export
                    </button>
                    <a href="members.html" class="btn btn-primary">
                        + Find More Speakers
                    </a>
                </div>
            </div>

            <!-- Speakers Content -->
            <div id="speakersContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Loading saved speakers...
                </div>
            </div>
        </div>
    </main>

    <!-- Contact Speaker Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Contact Speaker</h3>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-group">
                        <label for="contactSubject">Subject</label>
                        <input type="text" id="contactSubject" required placeholder="Speaking opportunity at...">
                    </div>
                    <div class="form-group">
                        <label for="contactMessage">Message</label>
                        <textarea id="contactMessage" required placeholder="Hello, we have an exciting speaking opportunity..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contactOpportunity">Related Opportunity (Optional)</label>
                        <select id="contactOpportunity">
                            <option value="">Select an opportunity...</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="sendMessage()" class="btn btn-primary">Send Message</button>
            </div>
        </div>
    </div>

    <!-- Remove Speaker Modal -->
    <div id="removeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Remove Saved Speaker</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to remove <strong id="removeSpeakerName"></strong> from your saved speakers?</p>
                <p style="margin-top: 1rem; color: #666;">This action cannot be undone. Any notes you've added will also be deleted.</p>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                <button onclick="confirmRemoveSpeaker()" class="btn btn-danger">Remove Speaker</button>
            </div>
        </div>
    </div>

    <!-- Load Supabase from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Load config and Supabase client -->
    <script src="js/config.js"></script>
    <script src="js/supabase-client.js"></script>
    
    <script>
        // Page state
        let currentUser = null;
        let savedSpeakers = [];
        let filteredSpeakers = [];
        let currentView = 'grid';
        let selectedSpeakerId = null;
        let editingNotesId = null;
        let myOpportunities = [];

        // Wait for Supabase client
        function waitForSupabase(callback) {
            let attempts = 0;
            const maxAttempts = 10;
            
            function check() {
                attempts++;
                if (typeof window.covetalks !== 'undefined' && window.covetalks.supabase) {
                    callback();
                } else if (attempts < maxAttempts) {
                    setTimeout(check, 500);
                } else {
                    console.error('Failed to initialize Supabase client');
                    window.location.href = '/login.html';
                }
            }
            check();
        }

        // Initialize page
        async function initializePage() {
            waitForSupabase(async () => {
                try {
                    // Check authentication
                    const session = await window.covetalks.checkAuth();
                    if (!session) {
                        window.location.href = '/login.html';
                        return;
                    }

                    // Get user profile
                    currentUser = await window.covetalks.getMemberProfile(session.user.id);
                    if (!currentUser || currentUser.member_type !== 'Organization') {
                        // Redirect non-organization users
                        window.location.href = '/dashboard.html';
                        return;
                    }

                    // Update UI with user info
                    updateUserInterface();

                    // Load saved speakers
                    await loadSavedSpeakers();

                    // Load opportunities for contact form
                    await loadOpportunities();

                } catch (error) {
                    console.error('Initialization error:', error);
                    alert('Failed to load saved speakers. Please try refreshing the page.');
                }
            });
        }

        // Update user interface
        function updateUserInterface() {
            const initials = currentUser.name ? 
                currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : 
                'O';
            document.getElementById('userAvatar').textContent = initials;
        }

        // Load saved speakers
        async function loadSavedSpeakers() {
            try {
                savedSpeakers = await window.covetalks.getSavedSpeakers();
                filteredSpeakers = [...savedSpeakers];
                
                updateStats();
                displaySpeakers();
                
            } catch (error) {
                console.error('Error loading saved speakers:', error);
                displayError();
            }
        }

        // Load opportunities for contact form
        async function loadOpportunities() {
            try {
                myOpportunities = await window.covetalks.getMyOpportunities('Open');
                
                // Populate contact form dropdown
                const select = document.getElementById('contactOpportunity');
                select.innerHTML = '<option value="">Select an opportunity...</option>' +
                    myOpportunities.map(opp => 
                        `<option value="${opp.id}">${opp.title} - ${formatDate(opp.event_date)}</option>`
                    ).join('');
                    
            } catch (error) {
                console.error('Error loading opportunities:', error);
            }
        }

        // Update statistics
        function updateStats() {
            const total = savedSpeakers.length;
            const withNotes = savedSpeakers.filter(s => s.notes && s.notes.trim()).length;
            
            const thisMonth = new Date();
            thisMonth.setDate(1);
            const recentlyAdded = savedSpeakers.filter(s => 
                new Date(s.created_at) >= thisMonth
            ).length;
            
            const topRated = savedSpeakers.filter(s => 
                s.speaker?.average_rating >= 4.5
            ).length;
            
            document.getElementById('totalSaved').textContent = total;
            document.getElementById('withNotes').textContent = withNotes;
            document.getElementById('recentlyAdded').textContent = recentlyAdded;
            document.getElementById('topRated').textContent = topRated;
        }

        // Display speakers
        function displaySpeakers() {
            const container = document.getElementById('speakersContent');
            
            if (filteredSpeakers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">⭐</div>
                        <h3>No saved speakers yet</h3>
                        <p>Start building your speaker collection by browsing and saving speakers.</p>
                        <a href="members.html" class="btn btn-primary" style="margin-top: 1rem;">
                            Browse Speakers
                        </a>
                    </div>
                `;
                return;
            }
            
            if (currentView === 'grid') {
                displayGridView();
            } else {
                displayListView();
            }
        }

        // Display grid view
        function displayGridView() {
            const container = document.getElementById('speakersContent');
            
            container.innerHTML = `
                <div class="speakers-grid">
                    ${filteredSpeakers.map(item => {
                        const speaker = item.speaker;
                        const initials = speaker.name ? 
                            speaker.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2) : 
                            '??';
                        
                        const avatarContent = speaker.profile_image_url ? 
                            `<img src="${speaker.profile_image_url}" alt="${speaker.name}">` :
                            initials;
                        
                        const rating = speaker.average_rating || 0;
                        const stars = '⭐'.repeat(Math.floor(rating)) + '☆'.repeat(5 - Math.floor(rating));
                        
                        const specialties = speaker.specialties || [];
                        
                        return `
                            <div class="speaker-card">
                                <div class="saved-indicator">⭐</div>
                                <div class="speaker-header">
                                    <div class="speaker-avatar">
                                        ${avatarContent}
                                    </div>
                                    <div class="speaker-info">
                                        <h3>${speaker.name || 'Unknown'}</h3>
                                        <div class="speaker-location">${speaker.location || 'Location not specified'}</div>
                                        ${rating > 0 ? `
                                        <div class="speaker-rating">
                                            <span class="stars">${stars}</span>
                                            <span class="rating-value">(${rating.toFixed(1)})</span>
                                        </div>` : ''}
                                    </div>
                                </div>
                                <div class="speaker-bio">
                                    ${speaker.bio ? speaker.bio.substring(0, 150) + (speaker.bio.length > 150 ? '...' : '') : 'No bio available'}
                                </div>
                                ${specialties.length > 0 ? `
                                <div class="speaker-specialties">
                                    ${specialties.slice(0, 3).map(s => `<span class="specialty-tag">${s}</span>`).join('')}
                                    ${specialties.length > 3 ? `<span class="specialty-tag">+${specialties.length - 3}</span>` : ''}
                                </div>` : ''}
                                
                                <div class="speaker-notes">
                                    <div class="notes-header">
                                        <span class="notes-label">Your Notes:</span>
                                        ${editingNotesId !== item.id ? 
                                            `<button class="edit-notes-btn" onclick="editNotes('${item.id}')">Edit</button>` :
                                            ''
                                        }
                                    </div>
                                    ${editingNotesId === item.id ? `
                                        <textarea class="notes-input" id="notes-${item.id}">${item.notes || ''}</textarea>
                                        <div class="notes-actions">
                                            <button onclick="cancelEditNotes()" class="btn btn-secondary btn-sm">Cancel</button>
                                            <button onclick="saveNotes('${item.id}', '${speaker.id}')" class="btn btn-primary btn-sm">Save</button>
                                        </div>
                                    ` : `
                                        <div class="notes-content">
                                            ${item.notes || 'No notes added yet.'}
                                        </div>
                                    `}
                                </div>
                                
                                <div class="card-actions">
                                    <button onclick="showContactModal('${speaker.id}', '${speaker.name}')" class="btn btn-primary btn-sm">
                                        Contact
                                    </button>
                                    <a href="speaker-profile.html?id=${speaker.id}" class="btn btn-secondary btn-sm">
                                        View Profile
                                    </a>
                                    <button onclick="showRemoveModal('${speaker.id}', '${speaker.name}')" class="btn btn-danger btn-sm">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Display list view
        function displayListView() {
            const container = document.getElementById('speakersContent');
            
            container.innerHTML = `
                <div class="speakers-list">
                    <table class="speakers-table">
                        <thead>
                            <tr>
                                <th>Speaker</th>
                                <th>Location</th>
                                <th>Specialties</th>
                                <th>Rating</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredSpeakers.map(item => {
                                const speaker = item.speaker;
                                const specialties = speaker.specialties || [];
                                const rating = speaker.average_rating || 0;
                                
                                return `
                                    <tr>
                                        <td>
                                            <strong>${speaker.name || 'Unknown'}</strong><br>
                                            <small>${speaker.email || ''}</small>
                                        </td>
                                        <td>${speaker.location || '-'}</td>
                                        <td>${specialties.slice(0, 2).join(', ') || '-'}</td>
                                        <td>${rating > 0 ? `⭐ ${rating.toFixed(1)}` : '-'}</td>
                                        <td>
                                            <small>${item.notes ? item.notes.substring(0, 50) + '...' : 'No notes'}</small>
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <button onclick="showContactModal('${speaker.id}', '${speaker.name}')" class="btn btn-primary btn-sm">
                                                    Contact
                                                </button>
                                                <button onclick="showRemoveModal('${speaker.id}', '${speaker.name}')" class="btn btn-danger btn-sm">
                                                    Remove
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Set view
        function setView(view) {
            currentView = view;
            
            // Update toggle buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displaySpeakers();
        }

        // Filter speakers
        function filterSpeakers() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const specialty = document.getElementById('specialtyFilter').value;
            
            filteredSpeakers = savedSpeakers.filter(item => {
                const speaker = item.speaker;
                
                // Search filter
                if (search) {
                    const nameMatch = speaker.name?.toLowerCase().includes(search);
                    const bioMatch = speaker.bio?.toLowerCase().includes(search);
                    const notesMatch = item.notes?.toLowerCase().includes(search);
                    if (!nameMatch && !bioMatch && !notesMatch) return false;
                }
                
                // Specialty filter
                if (specialty) {
                    const specialties = speaker.specialties || [];
                    if (!specialties.some(s => s.includes(specialty))) return false;
                }
                
                return true;
            });
            
            displaySpeakers();
        }

        // Sort speakers
        function sortSpeakers() {
            const sortBy = document.getElementById('sortBy').value;
            
            filteredSpeakers.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return (a.speaker.name || '').localeCompare(b.speaker.name || '');
                    case 'rating':
                        return (b.speaker.average_rating || 0) - (a.speaker.average_rating || 0);
                    case 'location':
                        return (a.speaker.location || '').localeCompare(b.speaker.location || '');
                    case 'recent':
                    default:
                        return new Date(b.created_at) - new Date(a.created_at);
                }
            });
            
            displaySpeakers();
        }

        // Edit notes
        function editNotes(savedSpeakerId) {
            editingNotesId = savedSpeakerId;
            displaySpeakers();
        }

        // Cancel edit notes
        function cancelEditNotes() {
            editingNotesId = null;
            displaySpeakers();
        }

        // Save notes
        async function saveNotes(savedSpeakerId, speakerId) {
            const notes = document.getElementById(`notes-${savedSpeakerId}`).value;
            
            try {
                await window.covetalks.updateSavedSpeakerNotes(speakerId, notes);
                
                // Update local data
                const item = savedSpeakers.find(s => s.id === savedSpeakerId);
                if (item) {
                    item.notes = notes;
                }
                
                editingNotesId = null;
                displaySpeakers();
                updateStats();
                
            } catch (error) {
                console.error('Error saving notes:', error);
                alert('Failed to save notes. Please try again.');
            }
        }

        // Show contact modal
        function showContactModal(speakerId, speakerName) {
            selectedSpeakerId = speakerId;
            document.getElementById('contactSubject').value = `Speaking Opportunity from ${currentUser.name}`;
            document.getElementById('contactMessage').value = '';
            document.getElementById('contactModal').classList.add('show');
        }

        // Show remove modal
        function showRemoveModal(speakerId, speakerName) {
            selectedSpeakerId = speakerId;
            document.getElementById('removeSpeakerName').textContent = speakerName;
            document.getElementById('removeModal').classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('contactModal').classList.remove('show');
            document.getElementById('removeModal').classList.remove('show');
            selectedSpeakerId = null;
        }

        // Send message
        async function sendMessage() {
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            const opportunityId = document.getElementById('contactOpportunity').value || null;
            
            if (!subject || !message) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                await window.covetalks.sendMessage(selectedSpeakerId, subject, message, opportunityId);
                alert('Message sent successfully!');
                closeModal();
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message. Please try again.');
            }
        }

        // Confirm remove speaker
        async function confirmRemoveSpeaker() {
            try {
                await window.covetalks.removeSavedSpeaker(selectedSpeakerId);
                
                // Remove from local data
                savedSpeakers = savedSpeakers.filter(s => s.speaker.id !== selectedSpeakerId);
                filteredSpeakers = filteredSpeakers.filter(s => s.speaker.id !== selectedSpeakerId);
                
                closeModal();
                updateStats();
                displaySpeakers();
                
            } catch (error) {
                console.error('Error removing speaker:', error);
                alert('Failed to remove speaker. Please try again.');
            }
        }

        // Export speakers
        async function exportSpeakers() {
            try {
                const result = await window.covetalks.exportSavedSpeakers('csv');
                
                // Create download link
                const blob = new Blob([result.data], { type: result.mimeType });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = result.filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
            } catch (error) {
                console.error('Error exporting speakers:', error);
                alert('Failed to export speakers. Please try again.');
            }
        }

        // Display error
        function displayError() {
            const container = document.getElementById('speakersContent');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">⚠️</div>
                    <h3>Error Loading Speakers</h3>
                    <p>There was an error loading your saved speakers.</p>
                    <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 1rem;">
                        Try Again
                    </button>
                </div>
            `;
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'Date TBD';
            return new Date(dateString).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        // Toggle dropdown
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('dropdownMenu');
            const avatar = document.getElementById('userAvatar');
            
            if (!avatar.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // Logout
        async function logout() {
            if (window.covetalks) {
                await window.covetalks.logout();
            }
        }

        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }
    </script>
</body>
</html>